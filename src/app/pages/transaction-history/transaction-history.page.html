<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title>Historial de Fraudes</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <ion-list-header>
    <ion-label>Transacciones Detectadas</ion-label>
  </ion-list-header>

  <ion-searchbar 
    placeholder="Buscar por nombre o tarjeta..."
    (ionInput)="onSearch($event)"
    [debounce]="300"> 
  </ion-searchbar>

  <div *ngIf="historial.length === 0 && !isLoading" class="empty-state">
    <ion-icon name="shield-checkmark-outline"></ion-icon>
    <h3>¡Todo en orden!</h3>
    <p>No se han detectado transacciones fraudulentas.</p>
  </div>

  <ion-list [inset]="true" *ngIf="historial.length > 0">
    
    <ion-item-sliding *ngFor="let item of historial" #slidingItem>
      
      <ion-item (click)="transactionDetails(item.transaction_id)" [detail]="true" lines="inset">
        <ion-icon name="alert-circle-outline" slot="start" color="danger"></ion-icon>
        <ion-label>
          <h2>{{ item.name }}</h2>
          <p>Tarjeta: ...{{ item.card_last_four }} - TX ID: {{ item.transaction_id }}</p>
          <p>Chip Usado: {{ item.used_chip ? 'Sí' : 'No' }}</p>
        </ion-label>
      </ion-item>

      <ion-item-options side="end">
        <ion-item-option color="danger" (click)="deleteTransaction(item.transaction_id, slidingItem)">
          <ion-icon slot="icon-only" name="trash-outline"></ion-icon>
        </ion-item-option>
      </ion-item-options>
      
    </ion-item-sliding>
  </ion-list>

  </ion-content>

<ion-footer *ngIf="totalPages > 1">
  <ion-toolbar class="pagination-toolbar">
    
    <ion-buttons slot="start">
      <ion-button (click)="goToFirst()" [disabled]="currentPage === 1" fill="clear">
        <ion-icon slot="icon-only" name="caret-back-circle-outline"></ion-icon>
      </ion-button>
      <ion-button (click)="goToPrevious()" [disabled]="currentPage === 1" fill="clear">
        <ion-icon slot="icon-only" name="chevron-back-outline"></ion-icon>
      </ion-button>
    </ion-buttons>

    <ion-title class="pagination-title">
      Pág {{ currentPage }} de {{ totalPages }}
    </ion-title>

    <ion-buttons slot="end">
      <ion-button (click)="goToNext()" [disabled]="currentPage === totalPages" fill="clear">
        <ion-icon slot="icon-only" name="chevron-forward-outline"></ion-icon>
      </ion-button>
      <ion-button (click)="goToLast()" [disabled]="currentPage === totalPages" fill="clear">
        <ion-icon slot="icon-only" name="caret-forward-circle-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
    
  </ion-toolbar>
</ion-footer>